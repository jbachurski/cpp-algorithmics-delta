import base64

code = "aW1wb3J0IHN5cwoKZGlycyA9ICgoMCwgMSksICgxLCAwKSwgKDAsIC0xKSwgKC0xLCAwKSkKCiMgYSA8PSBiayA8PSBjLCBhc3N1bWUgYiA+IDAKZGVmIGNvdW50X211bHRpcGxlcyhhLCBiLCBjKToKICAgIHAgPSBhICsgKGIgLSBhJWIpICUgYjsgcSA9IGMgLSBjJWIKICAgIHJldHVybiAocSAtIHApLy9iICsgMSBpZiBhIDw9IGMgYW5kIHAgPD0gcSBlbHNlIDAKCmRlZiBpbnRfcmVhZGVyKCk6CiAgICB5aWVsZCBmcm9tIChpbnQoZCkgZm9yIGQgaW4gc3lzLnN0ZGluLnJlYWQoKS5zcGxpdCgpKQoKZGVmIG1haW4oKToKICAgIGludHMgPSBpbnRfcmVhZGVyKCkKICAgIG4sIHQgPSBuZXh0KGludHMpLCBuZXh0KGludHMpCiAgICBEID0gW25leHQoaW50cykgZm9yIF8gaW4gcmFuZ2UobildCiAgICBfRCwgX24gPSBELmNvcHkoKSwgbgogICAgd2hpbGUgbGVuKEQpICUgNDoKICAgICAgICBEICs9IF9EOyBuICs9IF9uCgogICAgdHMgPSBzdW0oRCkKICAgIHBfYmFzZSwgdF9hZnRlciA9IGRpdm1vZCh0LCAodHMgKyBuKSkKICAgIGlfYWZ0ZXIgPSBuOwogICAgUCA9IFtwX2Jhc2UgZm9yIF8gaW4gcmFuZ2UobildCiAgICBmb3IgaSBpbiByYW5nZShuKToKICAgICAgICBpZiB0X2FmdGVyID49IERbaV0gKyAxOgogICAgICAgICAgICBQW2ldICs9IDE7IHRfYWZ0ZXIgLT0gRFtpXSArIDEKICAgICAgICBlbHNlOgogICAgICAgICAgICBpX2FmdGVyID0gaTsgYnJlYWsKCiAgICB4dCwgeXQgPSBuZXh0KGludHMpLCBuZXh0KGludHMpCgogICAgciA9IDAKICAgIGlmICh4dCwgeXQpID09ICgwLCAwKTogciArPSAxCgogICAgZm9yIHJvdCBpbiByYW5nZSg0KToKICAgICAgICB4cywgeXMgPSAwLCAwCiAgICAgICAgWFMsIFlTID0gWzAgZm9yIF8gaW4gcmFuZ2UobisxKV0sIFswIGZvciBfIGluIHJhbmdlKG4rMSldCiAgICAgICAgZm9yIGkgaW4gcmFuZ2Uobik6CiAgICAgICAgICAgIHhzICs9IGRpcnNbKGkrcm90KSU0XVswXSAqIERbaV0KICAgICAgICAgICAgeXMgKz0gZGlyc1soaStyb3QpJTRdWzFdICogRFtpXQogICAgICAgICAgICBYU1tpKzFdLCBZU1tpKzFdID0geHMsIHlzCiAgICAgICAgZGVmIHByZWRfeHMwKGkpOiByZXR1cm4geHQgLSBEW2ldIDw9IFhTW2ldIDwgeHQKICAgICAgICBkZWYgcHJlZF95czAoaSk6IHJldHVybiB5dCA9PSBZU1tpXQogICAgICAgIGRlZiBwcmVkX3lzWChpKTogcmV0dXJuICh5dC1ZU1tpXSkgJSB5cyA9PSAwIGFuZCAwIDw9ICh5dCAtIFlTW2ldKSAvLyB5cyA8IFBbaV0KCiAgICAgICAgaXQgPSByYW5nZSgoNS1yb3QpJTQsIG4sIDQpCiAgICAgICAgaWYgeHMgPT0gMCBhbmQgeXMgPT0gMDoKICAgICAgICAgICAgZm9yIGkgaW4gaXQ6CiAgICAgICAgICAgICAgICBpZiBQW2ldIGFuZCBwcmVkX3lzMChpKSBhbmQgcHJlZF94czAoaSk6CiAgICAgICAgICAgICAgICAgICAgciArPSBQW2ldCiAgICAgICAgZWxpZiB4cyA9PSAwOgogICAgICAgICAgICBmb3IgaSBpbiBpdDoKICAgICAgICAgICAgICAgIGlmIFBbaV0gYW5kIHByZWRfeXNYKGkpIGFuZCBwcmVkX3hzMChpKToKICAgICAgICAgICAgICAgICAgICByICs9IDEKICAgICAgICBlbGlmIHlzID09IDA6CiAgICAgICAgICAgIGZvciBpIGluIGl0OgogICAgICAgICAgICAgICAgaWYgUFtpXSBhbmQgcHJlZF95czAoaSk6CiAgICAgICAgICAgICAgICAgICAgZSwgZiA9IHh0IC0gWFNbaV0gLSBEW2ldLCB4dCAtIFhTW2ldCiAgICAgICAgICAgICAgICAgICAgIyBlIDw9IHhzICogayA8IGYgYW5kIDAgPD0gayA8IFBbaV0KICAgICAgICAgICAgICAgICAgICBpZiB4cyA+IDA6CiAgICAgICAgICAgICAgICAgICAgICAgIHIgKz0gY291bnRfbXVsdGlwbGVzKG1heChlLCAwKSwgeHMsIG1pbihmLTEsIHhzKlBbaV0tMSkpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgciArPSBjb3VudF9tdWx0aXBsZXMobWF4KC1mKzEsIDApLCAteHMsIG1pbigtZSwgLXhzKlBbaV0tMSkpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgZm9yIGkgaW4gaXQ6CiAgICAgICAgICAgICAgICBrLCBlLCBmID0gKHl0IC0gWVNbaV0pIC8vIHlzLCB4dCAtIFhTW2ldIC0gRFtpXSwgeHQgLSBYU1tpXQogICAgICAgICAgICAgICAgaWYgUFtpXSBhbmQgcHJlZF95c1goaSkgYW5kIGUgPD0gayp4cyA8IGY6CiAgICAgICAgICAgICAgICAgICAgciArPSAxCgogICAgICAgIGlmIGlfYWZ0ZXIgPCBuIGFuZCBpX2FmdGVyJTQgPT0gKDUtcm90KSU0OgogICAgICAgICAgICBrID0gUFtpX2FmdGVyXQogICAgICAgICAgICBpZiB5dCA9PSB5cyprICsgWVNbaV9hZnRlcl0gYW5kIHhzKmsgKyBYU1tpX2FmdGVyXSA8IHh0IDw9IHhzKmsgKyBYU1tpX2FmdGVyXSArIHRfYWZ0ZXI6CiAgICAgICAgICAgICAgICByICs9IDEKCiAgICAgICAgeHQsIHl0ID0geXQsIC14dAoKICAgIHByaW50KHIpCgptYWluKCkK"

exec(base64.b64decode(code).decode("utf-8"))

